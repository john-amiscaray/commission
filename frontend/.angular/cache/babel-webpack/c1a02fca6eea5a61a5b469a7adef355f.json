{"ast":null,"code":"import { LobbyStatus, LobbyStatusType } from \"../../dtos/LobbyStatus\";\nimport { GameSettings } from \"../../dtos/GameSettings\";\nimport { ComponentWithSplashIntro } from \"../../component-interfaces/component-with-splash-intro\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/lobby.service\";\nimport * as i2 from \"../../services/auth.service\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"../../services/toast.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"../../services/profile-picture.service\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../common-components/load/load.component\";\n\nfunction LobbyPage_ng_container_5_p_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", ctx_r2.participants.size, \"/\", ctx_r2.lobby.settings.players, \" have joined \");\n  }\n}\n\nfunction LobbyPage_ng_container_5_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵelementStart(1, \"div\", 17);\n    i0.ɵɵelement(2, \"img\", 18);\n    i0.ɵɵelementStart(3, \"header\");\n    i0.ɵɵelementStart(4, \"h1\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"img\", 19);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const participant_r6 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", ctx_r3.pfp.getProfilePictureFromName(participant_r6[1].user.pfp), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", participant_r6[1].user.name, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", participant_r6[1].ready ? \"assets/icon/Ready.svg\" : \"assets/icon/NotReady.svg\", i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction LobbyPage_ng_container_5_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"h3\", 20);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r4.getLobbyStatusText(), \" \");\n  }\n}\n\nfunction LobbyPage_ng_container_5_ion_button_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-button\", 21);\n    i0.ɵɵlistener(\"click\", function LobbyPage_ng_container_5_ion_button_21_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.lobby.requestStart();\n    });\n    i0.ɵɵtext(1, \"Start game\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction LobbyPage_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"ion-grid\");\n    i0.ɵɵelementStart(2, \"ion-row\");\n    i0.ɵɵelementStart(3, \"ion-col\", 4);\n    i0.ɵɵelementStart(4, \"div\");\n    i0.ɵɵelementStart(5, \"ion-item-group\", 5);\n    i0.ɵɵelementStart(6, \"ion-text\");\n    i0.ɵɵelementStart(7, \"h3\");\n    i0.ɵɵtext(8, \"Room Code\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"h1\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"ion-row\");\n    i0.ɵɵelementStart(12, \"ion-col\", 6);\n    i0.ɵɵtemplate(13, LobbyPage_ng_container_5_p_13_Template, 2, 2, \"p\", 7);\n    i0.ɵɵelementStart(14, \"ion-card\", 8);\n    i0.ɵɵtemplate(15, LobbyPage_ng_container_5_div_15_Template, 7, 3, \"div\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"div\", 10);\n    i0.ɵɵelementStart(17, \"div\", 11);\n    i0.ɵɵtemplate(18, LobbyPage_ng_container_5_div_18_Template, 3, 1, \"div\", 3);\n    i0.ɵɵelementStart(19, \"ion-button\", 12);\n    i0.ɵɵlistener(\"click\", function LobbyPage_ng_container_5_Template_ion_button_click_19_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.toggleReady();\n    });\n    i0.ɵɵtext(20, \"Toggle ready\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(21, LobbyPage_ng_container_5_ion_button_21_Template, 2, 0, \"ion-button\", 13);\n    i0.ɵɵelementStart(22, \"ion-button\", 14);\n    i0.ɵɵlistener(\"click\", function LobbyPage_ng_container_5_Template_ion_button_click_22_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.leave();\n    });\n    i0.ɵɵtext(23, \"Leave Game\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(10);\n    i0.ɵɵtextInterpolate(ctx_r0.lobby.roomCode);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.lobby.settings);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.participants.entries());\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", !(ctx_r0.isHost && ctx_r0.allPlayersReady() && ctx_r0.participants.size === ctx_r0.lobby.settings.players));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isHost && ctx_r0.allPlayersReady() && ctx_r0.participants.size === ctx_r0.lobby.settings.players);\n  }\n}\n\nfunction LobbyPage_app_load_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-load\");\n  }\n}\n\nexport let LobbyPage = /*#__PURE__*/(() => {\n  class LobbyPage extends ComponentWithSplashIntro {\n    constructor(lobby, auth, platform, toast, router, pfp) {\n      super();\n      this.lobby = lobby;\n      this.auth = auth;\n      this.platform = platform;\n      this.toast = toast;\n      this.router = router;\n      this.pfp = pfp;\n      this.participants = new Map();\n      this.isHost = false;\n      this.loadingLobby = true;\n    }\n\n    ngOnInit() {// if(!this.lobby.connectedToLobby() && !this.auth.getRoomCode()){\n      //\n      //   this.router.navigate(['home']);\n      //\n      // }\n    }\n\n    lobbyInit() {\n      let self = this;\n      this.isHost = false;\n      this.participants = new Map();\n      this.lobby.addLobbyStatusCallback(status => {\n        if (status.host != -1) {\n          if (status.host === parseInt(self.auth.getGameId())) {\n            self.isHost = true;\n          }\n        }\n\n        if (status.statusType === LobbyStatusType.CONNECT) {\n          console.log(`CONNECT[${status.subject}]`);\n\n          if (status.participants != null && JSON.stringify(Array.from(self.participants.keys())) !== JSON.stringify(status.participants)) {\n            for (let id of status.participants) {\n              self.auth.getUserInfo(self.lobby.roomCode, id).subscribe(res => {\n                self.participants.set(id, {\n                  user: res,\n                  ready: false\n                });\n              });\n            }\n          }\n        } else if (status.statusType === LobbyStatusType.READY) {\n          self.participants.get(status.subject).ready = true;\n        } else if (status.statusType === LobbyStatusType.NOT_READY) {\n          self.participants.get(status.subject).ready = false;\n        } else if (status.statusType === LobbyStatusType.KICK_PLAYER || status.statusType === LobbyStatusType.DISCONNECT) {\n          console.log(`DISCONNECT[${status.subject}]`);\n\n          if (self.isMyId(status.subject)) {\n            self.lobby.leaveLobby();\n            self.router.navigate(['']).then(() => {\n              if (status.statusType === LobbyStatusType.KICK_PLAYER) {\n                self.toast.customToastMessage('You have been kicked from the server');\n              }\n            });\n          } else {\n            self.participants.delete(status.subject);\n          }\n        } else if (status.statusType === LobbyStatusType.START_GAME) {\n          self.lobby.startGame(this.participants);\n          self.router.navigate(['game']);\n        }\n      });\n      this.startConnection();\n    }\n\n    ionViewDidEnter() {\n      try {\n        if (!this.lobby.connectedToLobby()) {\n          console.log(\"Trying to restore the game\");\n          this.participants = new Map();\n          this.lobby.tryRestoreGameOrLeave(res => {\n            console.log(`The new game id is: ${JSON.stringify(res)}`);\n            this.lobbyInit();\n          });\n        } else {\n          this.lobbyInit();\n        }\n\n        this.loadingLobby = false;\n      } catch (e) {\n        console.log(e);\n        this.toast.customToastMessage('failed to join lobby, please try again');\n      }\n    }\n\n    ionViewDidLeave() {\n      this.participants = new Map();\n      this.isHost = false;\n      this.loadingLobby = true;\n    }\n\n    startConnection() {\n      // A little hacky but too bad!\n      this.lobby.sendStatusMessage(new LobbyStatus(LobbyStatusType.CONNECT, parseInt(this.auth.getGameId()), -1, [], new GameSettings()));\n    }\n\n    leave() {\n      this.router.navigate(['join-game']).then(_ => {\n        this.lobby.leaveLobby();\n      });\n    }\n\n    isMyId(id) {\n      return id === parseInt(this.auth.getGameId());\n    }\n\n    toggleReady() {\n      let me = this.participants.get(parseInt(this.auth.getGameId()));\n\n      if (me.ready) {\n        this.lobby.sendStatusMessage(new LobbyStatus(LobbyStatusType.NOT_READY, parseInt(this.auth.getGameId())));\n      } else {\n        this.lobby.sendStatusMessage(new LobbyStatus(LobbyStatusType.READY, parseInt(this.auth.getGameId())));\n      }\n    }\n\n    allPlayersReady() {\n      for (let player of this.participants.values()) {\n        if (!player.ready) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    getLobbyStatusText() {\n      if (!this.lobby.settings) {\n        return 'loading...';\n      }\n\n      if (this.participants.size === this.lobby.settings.players) {\n        if (this.allPlayersReady()) {\n          return 'Waiting for host to start game';\n        } else {\n          return 'Waiting for everyone to ready up';\n        }\n      } else {\n        return 'Waiting for enough players';\n      }\n    }\n\n    onBanSelection(selector) {\n      this.lobby.kickPlayer(selector.value);\n      selector.value = null;\n    }\n\n    beforeUnload() {\n      this.loadingLobby = true;\n    }\n\n  }\n\n  LobbyPage.ɵfac = function LobbyPage_Factory(t) {\n    return new (t || LobbyPage)(i0.ɵɵdirectiveInject(i1.LobbyService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.Platform), i0.ɵɵdirectiveInject(i4.ToastService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i6.ProfilePictureService));\n  };\n\n  LobbyPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LobbyPage,\n    selectors: [[\"app-lobby\"]],\n    hostBindings: function LobbyPage_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"beforeunload\", function LobbyPage_beforeunload_HostBindingHandler() {\n          return ctx.beforeUnload();\n        }, false, i0.ɵɵresolveWindow);\n      }\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 7,\n    vars: 2,\n    consts: [[\"color\", \"primary\"], [\"id\", \"app-background\", \"src\", \"assets/images/background.png\", \"alt\", \"background\"], [\"id\", \"content-wrapper\"], [4, \"ngIf\"], [\"size-md\", \"12\"], [\"id\", \"lobby-info\"], [\"size-md\", \"8\", \"offset-md\", \"2\", \"size-sm\", \"12\"], [\"id\", \"players-joined\", 4, \"ngIf\"], [\"id\", \"lobby-listings\"], [\"class\", \"lobby-list-item\", 4, \"ngFor\", \"ngForOf\"], [\"id\", \"lower\"], [\"id\", \"game-options\"], [\"color\", \"primary\", \"id\", \"ready\", 3, \"click\"], [\"id\", \"start-game\", \"color\", \"success\", 3, \"click\", 4, \"ngIf\"], [\"color\", \"danger\", \"id\", \"leave\", 3, \"click\"], [\"id\", \"players-joined\"], [1, \"lobby-list-item\"], [1, \"lobby-list-avatar\"], [\"alt\", \"you\", 1, \"pfp\", 3, \"src\"], [\"alt\", \"ready status\", 1, \"ready-status\", 3, \"src\"], [1, \"ion-text-center\"], [\"id\", \"start-game\", \"color\", \"success\", 3, \"click\"]],\n    template: function LobbyPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\");\n        i0.ɵɵelement(1, \"ion-toolbar\", 0);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(2, \"ion-content\");\n        i0.ɵɵelement(3, \"img\", 1);\n        i0.ɵɵelementStart(4, \"div\", 2);\n        i0.ɵɵtemplate(5, LobbyPage_ng_container_5_Template, 24, 5, \"ng-container\", 3);\n        i0.ɵɵtemplate(6, LobbyPage_app_load_6_Template, 1, 0, \"app-load\", 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loadingLobby);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.loadingLobby);\n      }\n    },\n    directives: [i3.IonHeader, i3.IonToolbar, i3.IonContent, i7.NgIf, i3.IonGrid, i3.IonRow, i3.IonCol, i3.IonItemGroup, i3.IonText, i3.IonCard, i7.NgForOf, i3.IonButton, i8.LoadComponent],\n    styles: [\"#content-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;width:100%;height:100%}#content-wrapper[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{width:50%}@media only screen and (max-width: 768px){#content-wrapper[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{width:90%}}#content-wrapper[_ngcontent-%COMP%]   #leave[_ngcontent-%COMP%]{font-size:16px}#content-wrapper[_ngcontent-%COMP%]   #game-options[_ngcontent-%COMP%]{width:50%;display:flex;flex-direction:column;margin:0 auto;align-items:center}#content-wrapper[_ngcontent-%COMP%]   #game-options[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{width:33%}@media only screen and (max-width: 768px){#content-wrapper[_ngcontent-%COMP%]   #game-options[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{width:50%}}@media only screen and (max-width: 768px){#content-wrapper[_ngcontent-%COMP%]   #game-options[_ngcontent-%COMP%]{width:90%}}#content-wrapper[_ngcontent-%COMP%]   #upper[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;grid-gap:500px;gap:500px}#content-wrapper[_ngcontent-%COMP%]   #upper[_ngcontent-%COMP%]   #ban-player[_ngcontent-%COMP%]{margin-left:auto}#content-wrapper[_ngcontent-%COMP%]   #lower[_ngcontent-%COMP%]{align-self:flex-end;width:80%;position:relative;top:-10px;margin:0 auto}@media only screen and (max-width: 768px){#content-wrapper[_ngcontent-%COMP%]   #lower[_ngcontent-%COMP%]{top:-30px}}#content-wrapper[_ngcontent-%COMP%]   #lobby-info[_ngcontent-%COMP%]{margin:0 auto}#content-wrapper[_ngcontent-%COMP%]   #lobby-info[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{height:200px}#content-wrapper[_ngcontent-%COMP%]   #lobby-info[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin:0}#content-wrapper[_ngcontent-%COMP%]   #lobby-info[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;font-size:30px}#content-wrapper[_ngcontent-%COMP%]   #lobby-info[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;font-family:Marker,serif;font-size:40px}#content-wrapper[_ngcontent-%COMP%]   .lobby-list-item[_ngcontent-%COMP%]{width:100%;font-weight:bolder;color:#000;display:flex;flex-direction:row;grid-gap:30px;gap:30px;align-items:center}#content-wrapper[_ngcontent-%COMP%]   .lobby-list-item[_ngcontent-%COMP%]   .lobby-list-avatar[_ngcontent-%COMP%]{display:flex;flex-direction:row;grid-gap:5px;gap:5px;width:95%}#content-wrapper[_ngcontent-%COMP%]   .lobby-list-item[_ngcontent-%COMP%]   .lobby-list-avatar[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{overflow-wrap:break-word;word-break:break-all}#content-wrapper[_ngcontent-%COMP%]   .lobby-list-item[_ngcontent-%COMP%]   .lobby-list-avatar[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}#content-wrapper[_ngcontent-%COMP%]   .lobby-list-item[_ngcontent-%COMP%]   .pfp[_ngcontent-%COMP%]{width:83px;height:83px}#content-wrapper[_ngcontent-%COMP%]   .lobby-list-item[_ngcontent-%COMP%]   .ready-status[_ngcontent-%COMP%]{width:25px;height:25px;margin-left:auto}#content-wrapper[_ngcontent-%COMP%]   #lobby-listings[_ngcontent-%COMP%]{overflow-y:auto;height:350px;padding:20px 40px;background-color:#ffffffad;-ms-overflow-style:none;scrollbar-width:none}#content-wrapper[_ngcontent-%COMP%]   #lobby-listings[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{display:none}@media only screen and (max-width: 768px){#content-wrapper[_ngcontent-%COMP%]   #lobby-listings[_ngcontent-%COMP%]{padding:10px 20px}}#players-joined[_ngcontent-%COMP%]{display:block;margin:0;text-indent:10px;font-weight:700}\"]\n  });\n  return LobbyPage;\n})();","map":null,"metadata":{},"sourceType":"module"}