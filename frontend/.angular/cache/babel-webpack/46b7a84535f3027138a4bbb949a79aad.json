{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { WebPlugin } from './index';\nimport { CameraResultType, CameraDirection, CameraSource } from '../core-plugin-definitions';\n\nvar CameraPluginWeb =\n/** @class */\nfunction (_super) {\n  __extends(CameraPluginWeb, _super);\n\n  function CameraPluginWeb() {\n    return _super.call(this, {\n      name: 'Camera',\n      platforms: ['web']\n    }) || this;\n  }\n\n  CameraPluginWeb.prototype.getPhoto = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , new Promise(function (resolve, reject) {\n          return __awaiter(_this, void 0, void 0, function () {\n            var cameraModal_1, e_1;\n\n            var _this = this;\n\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  if (!options.webUseInput) return [3\n                  /*break*/\n                  , 1];\n                  this.fileInputExperience(options, resolve);\n                  return [3\n                  /*break*/\n                  , 7];\n\n                case 1:\n                  if (!customElements.get('pwa-camera-modal')) return [3\n                  /*break*/\n                  , 6];\n                  cameraModal_1 = document.createElement('pwa-camera-modal');\n                  document.body.appendChild(cameraModal_1);\n                  _a.label = 2;\n\n                case 2:\n                  _a.trys.push([2, 4,, 5]);\n\n                  return [4\n                  /*yield*/\n                  , cameraModal_1.componentOnReady()];\n\n                case 3:\n                  _a.sent();\n\n                  cameraModal_1.addEventListener('onPhoto', function (e) {\n                    return __awaiter(_this, void 0, void 0, function () {\n                      var photo, _a;\n\n                      return __generator(this, function (_b) {\n                        switch (_b.label) {\n                          case 0:\n                            photo = e.detail;\n                            if (!(photo === null)) return [3\n                            /*break*/\n                            , 1];\n                            reject('User cancelled photos app');\n                            return [3\n                            /*break*/\n                            , 4];\n\n                          case 1:\n                            if (!(photo instanceof Error)) return [3\n                            /*break*/\n                            , 2];\n                            reject(photo.message);\n                            return [3\n                            /*break*/\n                            , 4];\n\n                          case 2:\n                            _a = resolve;\n                            return [4\n                            /*yield*/\n                            , this._getCameraPhoto(photo, options)];\n\n                          case 3:\n                            _a.apply(void 0, [_b.sent()]);\n\n                            _b.label = 4;\n\n                          case 4:\n                            cameraModal_1.dismiss();\n                            document.body.removeChild(cameraModal_1);\n                            return [2\n                            /*return*/\n                            ];\n                        }\n                      });\n                    });\n                  });\n                  cameraModal_1.present();\n                  return [3\n                  /*break*/\n                  , 5];\n\n                case 4:\n                  e_1 = _a.sent();\n                  this.fileInputExperience(options, resolve);\n                  return [3\n                  /*break*/\n                  , 5];\n\n                case 5:\n                  return [3\n                  /*break*/\n                  , 7];\n\n                case 6:\n                  console.error(\"Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.\");\n                  this.fileInputExperience(options, resolve);\n                  _a.label = 7;\n\n                case 7:\n                  return [2\n                  /*return*/\n                  ];\n              }\n            });\n          });\n        })];\n      });\n    });\n  };\n\n  CameraPluginWeb.prototype.fileInputExperience = function (options, resolve) {\n    var input = document.querySelector('#_capacitor-camera-input');\n\n    var cleanup = function () {\n      input.parentNode && input.parentNode.removeChild(input);\n    };\n\n    if (!input) {\n      input = document.createElement('input');\n      input.id = '_capacitor-camera-input';\n      input.type = 'file';\n      document.body.appendChild(input);\n    }\n\n    input.accept = 'image/*';\n    input.capture = true;\n\n    if (options.source === CameraSource.Photos || options.source === CameraSource.Prompt) {\n      input.removeAttribute('capture');\n    } else if (options.direction === CameraDirection.Front) {\n      input.capture = 'user';\n    } else if (options.direction === CameraDirection.Rear) {\n      input.capture = 'environment';\n    }\n\n    input.addEventListener('change', function (_e) {\n      var file = input.files[0];\n      var format = 'jpeg';\n\n      if (file.type === 'image/png') {\n        format = 'png';\n      } else if (file.type === 'image/gif') {\n        format = 'gif';\n      }\n\n      if (options.resultType === CameraResultType.DataUrl || options.resultType === CameraResultType.Base64) {\n        var reader_1 = new FileReader();\n        reader_1.addEventListener('load', function () {\n          if (options.resultType === CameraResultType.DataUrl) {\n            resolve({\n              dataUrl: reader_1.result,\n              format: format\n            });\n          } else if (options.resultType === CameraResultType.Base64) {\n            var b64 = reader_1.result.split(',')[1];\n            resolve({\n              base64String: b64,\n              format: format\n            });\n          }\n\n          cleanup();\n        });\n        reader_1.readAsDataURL(file);\n      } else {\n        resolve({\n          webPath: URL.createObjectURL(file),\n          format: format\n        });\n        cleanup();\n      }\n    });\n    input.click();\n  };\n\n  CameraPluginWeb.prototype._getCameraPhoto = function (photo, options) {\n    return new Promise(function (resolve, reject) {\n      var reader = new FileReader();\n      var format = photo.type.split('/')[1];\n\n      if (options.resultType === CameraResultType.Uri) {\n        resolve({\n          webPath: URL.createObjectURL(photo),\n          format: format\n        });\n      } else {\n        reader.readAsDataURL(photo);\n\n        reader.onloadend = function () {\n          var r = reader.result;\n\n          if (options.resultType === CameraResultType.DataUrl) {\n            resolve({\n              dataUrl: r,\n              format: format\n            });\n          } else {\n            resolve({\n              base64String: r.split(',')[1],\n              format: format\n            });\n          }\n        };\n\n        reader.onerror = function (e) {\n          reject(e);\n        };\n      }\n    });\n  };\n\n  return CameraPluginWeb;\n}(WebPlugin);\n\nexport { CameraPluginWeb };\nvar Camera = new CameraPluginWeb();\nexport { Camera }; //# sourceMappingURL=camera.js.map","map":null,"metadata":{},"sourceType":"module"}